# 📱 iPhoneでSupabaseにデータを移行する手順

このガイドでは、iPhoneのブラウザに保存されているデータをSupabaseクラウドに移行する方法を説明します。

---

## 🎯 移行するメリット

### 現在の問題
- ❌ データがiPhoneのブラウザ内にのみ保存されている
- ❌ 別のデバイスでアクセスできない
- ❌ ブラウザのデータを消すとすべて失われる
- ❌ リロードすると情報が取得できない状態

### 移行後のメリット
- ✅ どのデバイスからでもアクセス可能
- ✅ データが安全にクラウドに保存される
- ✅ 複数デバイス間でデータを同期
- ✅ ブラウザのキャッシュクリアでもデータが残る
- ✅ いつでもリロードして最新データを取得できる

---

## 📋 事前準備

移行作業を始める前に、以下が完了していることを確認してください：

### 1. Supabaseプロジェクトの作成（既に完了済み）
- ✅ プロジェクトURL: `https://neojybsjggkddmmzubjk.supabase.co`
- ✅ API Key: 設定済み
- ✅ データベーステーブル: 作成済み

### 2. 環境変数の設定（既に完了済み）
`.env.local`ファイルにSupabase設定が記載されています。

---

## 🚀 iPhoneでの移行手順

### ステップ1: アプリにアクセス

1. iPhoneのSafariまたはChromeを開く
2. アプリのURLにアクセス
   - ローカル: `http://localhost:3001`（開発時）
   - 本番: デプロイ先のURL

### ステップ2: 設定画面を開く

1. 画面下部または左側のメニューから **「設定」** タブをタップ
2. 下にスクロールして **「データ管理」** セクションを探す

### ステップ3: データを移行

1. **黄色の説明ボックス**が表示されます：
   ```
   📱 iPhoneのデータをクラウドに保存
   現在、データはiPhoneのブラウザ内のみに保存されています。
   Supabaseに移行すると、どのデバイスからもアクセスできるように
   なり、データが失われる心配もありません。
   ```

2. その下にある **青い大きなボタン** をタップ：
   ```
   Supabaseにデータを移行
   すべてのTodo・カレンダー・設定をクラウドに保存
   ```

3. 移行が開始されます（数秒〜数分かかります）
   - 「データを移行中...」と表示されます
   - **画面を閉じないでください**

4. 移行完了のメッセージが表示されます：
   ```
   移行完了！
   イベント: XX件
   TODO: XX件
   テンプレート: XX件
   カテゴリ: XX件
   ```

### ステップ4: ページをリロードして確認

1. 「その他の機能」セクションの **「ページを再読み込み」** ボタンをタップ
2. ページがリロードされ、Supabaseからデータが読み込まれます
3. 画面上部に「Supabase data loaded successfully」と表示されれば成功！

---

## ✅ 移行後の確認事項

### データが正しく移行されたか確認

1. **Todoリスト**を開いて、すべてのTodoが表示されているか確認
2. **カレンダー**を開いて、すべてのイベントが表示されているか確認
3. **ダッシュボード**で統計データが正しく表示されているか確認
4. **設定 > テンプレート管理**で、テンプレートが表示されているか確認
5. **設定 > カテゴリー管理**で、カテゴリーが表示されているか確認

### Supabaseダッシュボードで確認（オプション）

1. [Supabase Dashboard](https://supabase.com/dashboard) にアクセス
2. プロジェクトを選択
3. 左メニューの **「Table Editor」** を開く
4. 以下のテーブルにデータが入っているか確認：
   - `calendar_events` - カレンダーイベント
   - `todos` - Todoリスト
   - `templates` - テンプレート
   - `categories` - カテゴリー
   - `user_preferences` - ユーザー設定

---

## 🔄 移行後の使い方

### 他のデバイスでアクセスする

1. 別のデバイス（PC、iPad、別のiPhoneなど）でアプリにアクセス
2. **同じSupabase設定**が使われていれば、自動的にデータが同期されます
3. 最新のデータが表示されます

### データをリロードする

いつでも「ページを再読み込み」ボタンをタップすることで、Supabaseから最新データを取得できます。

### 変更はリアルタイムで保存される

- Todoを追加・編集・削除すると、即座にSupabaseに保存されます
- カレンダーイベントも同様に即座に保存されます
- 設定変更も「保存」ボタンを押すとSupabaseに保存されます

---

## 🛠️ トラブルシューティング

### エラー: "Supabase環境変数が設定されていません"

**原因**: Supabase設定が正しく読み込まれていない

**解決方法**:
1. `.env.local`ファイルが正しく設定されているか確認
2. 開発サーバーを再起動
3. ブラウザのキャッシュをクリア

### エラー: "relation 'calendar_events' does not exist"

**原因**: データベーステーブルが作成されていない

**解決方法**:
1. [SUPABASE_MIGRATION_GUIDE.md](./SUPABASE_MIGRATION_GUIDE.md) を参照
2. SQL Editorでマイグレーションを実行

### データが表示されない

**解決方法**:
1. 「ページを再読み込み」ボタンをタップ
2. ブラウザのコンソールを開いて（Safariの場合は開発者メニュー）、エラーメッセージを確認
3. インターネット接続を確認

### 移行中に画面を閉じてしまった

**解決方法**:
1. もう一度「Supabaseにデータを移行」ボタンをタップ
2. 重複データが作成される可能性がありますが、後で整理できます

---

## 📊 移行されるデータの詳細

### 1. カレンダーイベント
- タイトル、開始時刻、終了時刻
- カテゴリー、優先度、色
- 繰り返し設定
- 通知設定

### 2. Todoリスト
- Todo内容
- 完了状態
- 期限、作成日
- 優先度
- 繰り返し設定

### 3. テンプレート
- テンプレート名
- デフォルト時間
- カテゴリー、優先度、色

### 4. カテゴリー
- カテゴリー名
- 色設定
- デフォルト設定

### 5. ユーザー設定
- 集中タイプ（朝型/夜型）
- 作業時間、休憩時間
- 起床時刻、就寝時刻
- 通知設定

### 6. 目標設定
- 学習時間目標
- 勤務時間目標
- Todo達成率目標

---

## ⚠️ 重要な注意事項

1. **移行後もローカルデータは残ります**
   - ブラウザ内のデータは削除されません
   - いつでもバックアップを取ることができます

2. **移行は何度でも実行できます**
   - ただし、重複データが作成される可能性があります
   - 初回の移行後は、Supabaseのデータを直接使用することをお勧めします

3. **データのバックアップ**
   - 移行前に「ローカルデータをバックアップ」ボタンでJSONファイルをダウンロードすることをお勧めします

---

## 🎉 完了！

これで、iPhoneのデータがSupabaseに移行されました！

今後は：
- ✅ どのデバイスからでもアクセス可能
- ✅ データが安全に保存
- ✅ 自動的に同期
- ✅ いつでもリロード可能

何か問題があれば、[SUPABASE_MIGRATION_GUIDE.md](./SUPABASE_MIGRATION_GUIDE.md) または開発者に相談してください。
